<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.solution.groupware.mapper.ProjectMapper">

	<!-- 프로젝트 목록 조회  -->
	<select id="selectProjectList" resultType="ProjectVO">
		/* selectProjectList */
		SELECT
			IDX,
			NAME,
			DEPT_IDX,
			CASE
				WHEN DEPT_IDX IS NULL THEN ''
				ELSE ''
			END AS DEPT_NAME,
			PM_USER_IDX,
			CASE
				WHEN PM_USER_IDX IS NULL THEN ''
				ELSE ''
			END AS PM_USER_NAME,
			PL_USER_IDX,
			CASE
				WHEN PL_USER_IDX IS NULL THEN ''
				ELSE ''
			END AS PL_USER_NAME,
			CLIENT_IDX,
			CASE
				WHEN CLIENT_IDX IS NULL THEN ''
				ELSE ''
			END AS CLIENT_NAME,
			WORKFLOW,
			CASE
				WHEN WORKFLOW IS NULL THEN ''
				ELSE (SELECT VALUE FROM CODE_INFO WHERE USE_YN = 'Y' AND GRP_CODE = 'PROJECT_WORKFLOW' AND CODE = WORKFLOW)
			END AS WORKFLOW_NAME,
			DATE_FORMAT(PLAN_DATE_ST,  '%Y-%m-%d') AS PLAN_DATE_ST,
			DATE_FORMAT(PLAN_DATE_ED,  '%Y-%m-%d') AS PLAN_DATE_ED,
			CONTRACT_AMOUNT,
			WORK_AMOUNT,
			WORK_USER_COUNT,
			OUTLINE,
			SIGNIFICANT,
			REG_DATE,
			MOD_DATE
		FROM
			PROJECT_INFO PI
		WHERE
			PI.USE_YN = 'Y'
		ORDER BY
			PI.IDX DESC
	</select>

	<!-- 프로젝트 목록 조회 (메뉴용)  -->
	<select id="selectProjectListForMenu" resultType="ProjectVO">
		/* selectProjectListForMenu */
		SELECT
			IDX,
			NAME
		FROM
			PROJECT_INFO PI
		WHERE
			PI.USE_YN = 'Y'
		ORDER BY
			PI.IDX ASC
	</select>

	<!-- 프로젝트 상세 조회  -->
	<select id="selectProjectDetail" parameterType="hashmap" resultType="ProjectVO">
		/* selectProjectDetail */
		SELECT
			IDX,
			NAME,
			DEPT_IDX,
			CASE
				WHEN DEPT_IDX IS NULL THEN ''
				ELSE ''
			END AS DEPT_NAME,
			PM_USER_IDX,
			CASE
				WHEN PM_USER_IDX IS NULL THEN ''
				ELSE ''
			END AS PM_USER_NAME,
			PL_USER_IDX,
			CASE
				WHEN PL_USER_IDX IS NULL THEN ''
				ELSE ''
			END AS PL_USER_NAME,
			CLIENT_IDX,
			CASE
				WHEN CLIENT_IDX IS NULL THEN ''
				ELSE ''
			END AS CLIENT_NAME,
			WORKFLOW,
			CASE
				WHEN WORKFLOW IS NULL THEN ''
				ELSE (SELECT VALUE FROM CODE_INFO WHERE USE_YN = 'Y' AND GRP_CODE = 'PROJECT_WORKFLOW' AND CODE = WORKFLOW)
			END AS WORKFLOW_NAME,
			DATE_FORMAT(PLAN_DATE_ST,  '%Y-%m-%d') AS PLAN_DATE_ST,
			DATE_FORMAT(PLAN_DATE_ED,  '%Y-%m-%d') AS PLAN_DATE_ED,
			CONTRACT_AMOUNT,
			WORK_AMOUNT,
			WORK_USER_COUNT,
			OUTLINE,
			SIGNIFICANT,
			REG_DATE,
			MOD_DATE
		FROM
			PROJECT_INFO PI
		WHERE
			PI.USE_YN = 'Y'
			AND PI.IDX = #{idx}
	</select>
	
	<!-- 프로젝트 추가  -->
	<insert id="insertProject" parameterType="ProjectVO"  useGeneratedKeys="true" keyProperty="idx">
		INSERT
		INTO
		PROJECT_INFO
		(
			NAME,
			USER_IDX,
			DEPT_IDX,
			PM_USER_IDX,
			PL_USER_IDX,
			CLIENT_IDX,
			WORKFLOW,
			PLAN_DATE_ST,
			PLAN_DATE_ED,
			CONTRACT_AMOUNT,
			WORK_AMOUNT,
			WORK_USER_COUNT,
			OUTLINE,
			SIGNIFICANT,
			REG_DATE
		)
		VALUES
		(
			#{name},
			#{userIdx},
			#{deptIdx},
			#{pmUserIdx},
			#{plUserIdx},
			#{clientIdx},
			#{workflow},
			<choose>
				<when test="planDateSt == null or planDateSt == ''">NULL,</when>
				<otherwise>#{planDateSt},</otherwise>
			</choose>
			<choose>
				<when test="planDateEd == null or planDateEd == ''">NULL,</when>
				<otherwise>#{planDateEd},</otherwise>
			</choose>
			#{contractAmount},
			#{workAmount},
			#{workUserCount},
			#{outline},
			#{significant},
			SYSDATE()
		)
	</insert>
</mapper>